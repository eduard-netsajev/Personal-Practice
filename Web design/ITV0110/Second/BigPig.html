<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Big Pig</title>

</head>
<body>
<div>Your score:</div>
<span id="player_score" style="font-weight: bold">
    0
</span>

<div>Pig score:</div>
<span id="pig_score" style="font-weight: bold">
    0
</span>
<br>

<div>Current score:</div>
<span id="current_score">0</span>


<p>
    <button id="roll" onclick="roll()">Roll!</button>
</p>
<p id="dices"> 0 and 0 </p>
<button id="take" onclick="take()">Take</button>

<form onsubmit="return setThreshold(this);">
    <label>
    Pig threshold (above zero):
        <input type="number" id="setX" name="threshold" min="1" max=100 required value="20"></label>
    <input type = submit value="Set">
</form>

<p>
    <button id="restart" onclick="restart()">Restart</button>
</p>
<p id="messages"></p>

</body>

<script>

    var pigThreshold = 20;
    var playerTurn = true;

    var intervalVar; // variable used for timing roll() for Pig player

    var playerScore = 0;
    var pigScore = 0;

    function checkWin() {
        if (playerScore >= 100) {
            stopGame();
            setMessage("Player won!");
            return 1;
        }
        else if (pigScore >= 100) {
            stopGame();
            setMessage("Pig won!");
            return -1;
        }
        else {
            return 0;
        }
    }

    function stopGame() {
        toggleButtons(false);
        clearInterval(intervalVar);
    }

    function restart() {
        playerTurn = true;
        toggleButtons(true);
        setCurrentPoints(0);
        pigScore = 0;
        playerScore = 0;
        setPigScore(0);
        setPlayerScore(0);
        clearInterval(intervalVar);
        setMessage("");
    }

    function roll() {
        var firstDice = Math.floor((Math.random() * 6) + 1);
        var secondDice = Math.floor((Math.random() * 6) + 1);
        document.getElementById("dices").innerText = String(firstDice) + " and " + String(secondDice);

        var points;

        if((firstDice == 1 || secondDice == 1) && (firstDice != 1 || secondDice != 1)) {
            points = 0;
            playerTurn = !playerTurn;
            if (playerTurn) {
                clearInterval(intervalVar);
                toggleButtons(true);
            } else {
                setCurrentPoints(0);
                take();
            }
        }
        else if (firstDice == secondDice) {
            if (firstDice == 1) {
                points = getCurrentPoints() + 25;
            } else {
                points = getCurrentPoints() + firstDice * 4;
            }
        }
        else {
            points = getCurrentPoints() + firstDice + secondDice;
        }
        setCurrentPoints(points);
        return points;
    }


    function take() {
        playerScore += getCurrentPoints();
        setPlayerScore(playerScore);
        setCurrentPoints(0);
        if (checkWin() == 0) {
            toggleButtons(false);
            playerTurn = false;
            intervalVar = setInterval(pig_move, 1000);
        }
    }

    function pig_move() {
        var points = getCurrentPoints();

        if (points < pigThreshold && points + pigScore < 100) {
            points = roll();
            setCurrentPoints(points);
        } else {
            pigScore += points;
            setPigScore(pigScore);
            setCurrentPoints(0);

            if (checkWin() == 0) {
                toggleButtons(true);
                playerTurn = true;
            }
            clearInterval(intervalVar);
        }
    }

    function toggleButtons(toBool) {
        if (toBool) {
            document.getElementById("take").disabled = false;
            document.getElementById("roll").disabled = false;
        } else {
            document.getElementById("take").disabled = true;
            document.getElementById("roll").disabled = true;
        }
    }

    function getCurrentPoints() {
        return Number(document.getElementById("current_score").innerText);
    }
    function setCurrentPoints(points) {
        document.getElementById("current_score").innerText = String(points);
    }
    function getPigThreshold() {
        return String(pigThreshold);
    }

    function setMessage(message) {
        document.getElementById("messages").innerText = message;
    }

    function setThreshold(form) {
        pigThreshold = form.threshold.value;
        return false;
    }

    function setPlayerScore(points) {
        document.getElementById("player_score").innerText = String(points);
    }

    function setPigScore(points) {
        document.getElementById("pig_score").innerText = String(points);
    }

</script>

</html>